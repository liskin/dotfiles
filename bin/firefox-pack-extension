#!/usr/bin/env bash

set -eu -o pipefail

id=$(jq -r '.browser_specific_settings // .applications | .gecko.id' manifest.json)
if [[ ! $id ]]; then
	echo 'no id in manifest'
	exit 1
fi

firefox_app_id="{ec8030f7-c20a-464f-9b0e-13a3a9e97384}"
user_extension_dir=~/.mozilla/extensions/"$firefox_app_id"

git ls-tree -r --name-only HEAD | zip "$user_extension_dir"/"$id".xpi -@
